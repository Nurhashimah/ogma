- model_class = Document
.page-header
  %h1= t('document.list_of_document')
  
.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav
    %li= link_to content_tag(:li, fa_icon("asterisk", text: (t 'actions.new'))), new_document_path
  %ul.nav.navbar-nav.navbar-right
    %li.toga= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class: "index_search_bar"
    %li.dropdown
      %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
        = fa_icon "print", text: (t 'actions.print')
        %b.caret
      %ul.dropdown-menu
        %li= link_to  (fa_icon "file-pdf-o", text: (t 'document.generate_report')),  document_report_documents_path(params.merge(format: 'pdf' ))

.row
  %table.table-striped.table-hover.ogma
    %thead
      %tr 
        %th{style: "width:2%;"}
        %th{style: "width:7%;"}= sort_link(@search, :serialno, (t 'document.serial_no'))
        %th{style: "width:14%;"}= sort_link(@search, :refno, (t 'document.ref_no'))
        %th{style: "width:5%;"}= sort_link(@search, :category, (t 'document.category'))
        %th{style: "width:18%;"}= sort_link(@search, :title, (t 'document.title2'))
        %th{style: "width:6%;"}= sort_link(@search, :letterdt, (t 'document.letter_date'))
        %th{style: "width:6%;"}= sort_link(@search, :letterxdt, (t 'document.received_date'))
        %th{style: "width:14%;"}= sort_link(@search, :from, (t 'document.from'))
        %th{style: "width:8%;"}= sort_link(@search, :cc1date, ("Status / "+(t 'document.circulation_date')))
        %th{style: "width:15%;"}=(t 'document.action_notifications')
        %th{style: "width:5%;"}= sort_link(@search, :closed, (t 'document.file_closed'))

    %tbody
    = render "index_search"
    - @documents.group_by { |t| t.filedocer }.each do |filedocer, documents|
      %tr
        %td.group{:colspan => "11"}
          %span= filedocer [0]
      - for document in documents.sort_by{|x|x.letterxdt}.reverse
        %tr
          %td
            - if document.distribution_type==1 
              = fa_icon("envelope-o") 
            - elsif document.distribution_type==2
              = fa_icon("send-o")
          %td= document.serialno
          %td= link_to document.refno, document_path(document)
          %td.centre= document.render_document
          %td= document.title
          %td.centre= document.college.code=='amsas'? document.letterdt.try(:strftime, '%d-%m-%Y') : document.letterdt.try(:strftime, "%d %b %Y" )
          %td.centre= document.college.code=='amsas'? document.letterxdt.try(:strftime, '%d-%m-%Y') : document.letterxdt.try(:strftime, "%d %b %Y" )
          %td= document.from
          %td.centre
            - if document.college.code=='amsas'
              = document.cc2closed? ? (fa_icon('check'))+" "+document.cc2date.try(:strftime, "%d %b %Y" ) : fa_icon('times')
            - else
              = document.cc1closed? ? (fa_icon('check'))+" "+document.cc1date.try(:strftime, "%d %b %Y" ) : fa_icon('times')
          %td
            - total_recipient=document.circulations.count
            - if total_recipient <= 5
              - document.circulations.each_with_index do |circulation, ind|
                - if document.college.code=='amsas'
                  (#{ind+=1}) #{circulation.staff.staff_with_rank} 
                  =circulation.action_closed? ? fa_icon("check") : fa_icon("times")
                - else
                  (#{ind+=1}) #{circulation.staff.name} - #{circulation.action_taken}
                %br
            - else
              = total_recipient==User.where(userable_type: 'Staff').count ? "All staffs " : ""
              = " (Replies = #{document.circulations.where(action_closed: true).count} / #{total_recipient})"
          %td.centre
            = document.closed? ? fa_icon("check", :border => 0) : ""

  .right{style:"padding:0 30px; margin:0;"}= paginate @documents_pagi, :theme => 'twitter-bootstrap-3'
  

