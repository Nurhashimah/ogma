- model_class = Ptdo
.page-header
  %h1= t('staff.training.budget.participants_expenses')
= render 'shared/flashes'

.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav.navbar-right
    %li.toga= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class: "index_search_bar"
    %li= link_to content_tag(:li, fa_icon("print", text: (t 'actions.print'))), "#", class: 'bogus'

.row
  .col-md-12
    .alert.alert-warning
      %font{:color => "red"} *
      =t('staff.training.application_status.attended')
  %table.table-striped.table-hover.ogma
    %thead
      %tr
        %th No
        %th= sort_link(@search, :staff_id, t('staff.training.application_status.staff_name'))
        %th= sort_link(@search, :staff_positions_name, t('staff.position'))
        %th= sort_link(@search, :ptschedule_course_name, t('staff.training.application_status.course_name'))
        %th= sort_link(@search, :ptschedule_start, (t('staff.training.schedule.start')+' - '+t('staff.training.schedule.end')))
        %th
          = t('staff.training.schedule.duration')
          %font{:color => "red"} *
        %th= sort_link(@search, :ptschedule_final_price , t('staff.training.schedule.price'))
        %th= t('staff.training.schedule.budget_ok')
        %th= sort_link(@search, :ptschedule_min_participants , t('staff.training.schedule.min_participants'))
        %th= sort_link(@search, :payment, (t('staff.training.budget.local_order')+' / '+t('staff.training.budget.cash')))
        %th= t('staff.training.budget.remark')
      
    %tbody
      = render "index_search3"
      - no=0
      - @ptdos.group_by{|x|x.ptschedule_id}.each do |schedule_id, ptdos|
        - ptdos.each_with_index do |ptdo, indexx|
          %tr
            %td=no+=1
            %td=h link_to(ptdo.staff.name, staff_training_ptdo_path(ptdo))
            %td=h ptdo.staff.try(:positions).try(:first).try(:name)
            - if indexx==0
              %td{:rowspan=>"#{ptdos.count}"}=h ptdo.ptschedule.course.name
              %td{:rowspan=>"#{ptdos.count}", :align => :center}=h (ptdo.ptschedule.start.try(:strftime, '%d-%m-%Y')).to_s+" " +t('to').downcase+"  "+(ptdo.ptschedule.enddate.try(:strftime, '%d-%m-%Y')).to_s
              %td{:rowspan=>"#{ptdos.count}", :align => :center}=duration_in_string=Ptdo.staff_total_days([ptdo.id])
              %td{:rowspan=>"#{ptdos.count}"}=h ringgols(ptdo.ptschedule.final_price)
              %td{:rowspan=>"#{ptdos.count}", :align => :center}=h ptdo.ptschedule.budget_ok? ? image_tag('tick.png') : image_tag('cross.png')
              %td{:rowspan=>"#{ptdos.count}", :align => :center}
                - participants_no=Ptdo.where(ptschedule_id: schedule_id).count
                - if participants_no >= ptdo.ptschedule.min_participants
                  = image_tag('tick.png')
                - else
                  = image_tag('cross.png') 
                %br
                = participants_no.to_s+" / "+ptdo.ptschedule.min_participants.to_s+" ("+ptdo.ptschedule.max_participants.to_s+")"
            %td.centre=h ptdo.render_payment
            %td=h ptdo.remark

    .right{style:"padding:0 30px; margin:0;"}= paginate @ptdos, :theme => 'twitter-bootstrap-3'  