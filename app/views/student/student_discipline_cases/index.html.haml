- model_class = StudentDisciplineCase
.page-header
  %h1= t('student.discipline.title')
  
.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav
    - permitted_to? :create, :student_student_discipline_cases do
      %li= link_to content_tag(:li, fa_icon("asterisk", text: (t 'actions.new'))), new_student_student_discipline_case_path
  %ul.nav.navbar-nav.navbar-right
    %li.toga= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class:  "index_search_bar"
    - permitted_to? :discipline_report, :student_student_discipline_cases do
      %li.dropdown
        %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
          = fa_icon "print", text: (t 'actions.print')
          %b.caret
        %ul.dropdown-menu
          %li= link_to (fa_icon "file-pdf-o", text: (t "student.discipline.list")), discipline_report_student_student_discipline_cases_path(params.merge(format: 'pdf' ))
          - if @student_discipline_cases.group_by{|x|x.student_id}.count==1
            - stu= @student_discipline_cases[0].student_id
            %li= link_to (fa_icon "file-pdf-o", text: (t "student.discipline.report_title")), anacdotal_report_student_student_discipline_cases_path(student: stu, coverage: "logged", format: 'pdf')

.row.filter{style: "display:none;"}
  .col-md-2
    
.row
  %table.table-striped.table-hover.ogma
    %thead
      %tr
        %th= sort_link(@search, :status, (t 'student.discipline.status'))
        %th{:width=>'15%'}= sort_link(@search, :programme, (t 'student.discipline.programme'))
        - unless current_user.college.code=='amsas'
          %th{:width=>'80px'}= t 'student.discipline.year_semester'
          %th= sort_link(@search, :matrix_no, (t 'student.discipline.matrix_no'))
        %th{:width=>'20%'}= sort_link(@search, :student_id, (t 'student.discipline.student_id'))
        %th{:width=>'10%'}= sort_link(@search, :infraction_id, (t 'student.discipline.infraction'))
        %th{:width=>'10%'}= sort_link(@search, :reported_on, (t 'student.discipline.reported_on'))
        /%th{:width=>'10%'}= sort_link(@search, :file_id, (t 'student.discipline.file_id'))
        %th{:width=>'10%'}=sort_link(@search, :location_id, (t 'student.discipline.location_id'))
        %th{:width=>'15%'}=(t 'student.discipline.action_by')
        %th{:width=>'10%'}= sort_link(@search, :counselor_feedback, (t 'student.discipline.counselor_feedback'))
        
    %tbody
    = render "search_bar"
    
    - @student_discipline_cases.each do |student_discipline_case|
      %tr
        %td=h link_to student_discipline_case.render_status, student_student_discipline_case_path(student_discipline_case)
        %td=h student_discipline_case.student.course.programme_list
        - unless current_user.college.code=='amsas'
          %td
            - @intake=student_discipline_case.student.intake
            = Student.year_and_sem(@intake)
          %td=h student_discipline_case.student.matrixno
        %td=h student_discipline_case.student.name 
        %td=h student_discipline_case.render_infraction
        %td=h student_discipline_case.try(:reported_on).try(:strftime, '%d %b %Y')
        /%td=h student_discipline_case.cofile.try(:name)
        %td=h [3,4].include?(student_discipline_case.location.root.lclass) ? student_discipline_case.location.try(:combo_code) : student_discipline_case.location.try(:name)
        %td
          - if student_discipline_case.render_action_by==I18n.t('student.discipline.no_case')
            %font{style: 'color: red;'}=h student_discipline_case.render_action_by
          - else
            =h student_discipline_case.render_action_by
        %td
          - if StudentCounselingSession.pluck(:case_id).compact.uniq.include?(student_discipline_case.id)
            =h student_discipline_case.counselor_feedback? ? fa_icon('check') : t('student.discipline.not_completed')
            /= link_to image_tag("printer.png", :border => 0, :title => 'Feedback Referrer'),:controller=>:student_counseling_sessions ,:action => 'feedback_referrer', :id => student_discipline_case.id if !student_discipline_case.counselor_feedback.blank? %>
          - else
            = t('student.discipline.not_related')
         
  .right{style:"padding:0 30px; margin:0;"}= paginate @student_discipline_cases, :theme => 'twitter-bootstrap-3'


