- model_class = AssetLoss
.page-header
  %h1= t('asset.loss.title')#, :default => model_class.model_name.human.pluralize
  
.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav
    %li= link_to content_tag(:li, fa_icon("asterisk", text: (t 'actions.new'))), new_asset_loss_path
  %ul.nav.navbar-nav.navbar-right
    %li.toga= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class: "index_search_bar"
    - if @asset_losses.count > 0
      %li= link_to (fa_icon "print", text: (t 'actions.print')), loss_list_asset_losses_path(params.merge(:format => 'pdf'))
        
.row.filter{style: "display:none;"}
  .col-md-2
  
.row
  = form_tag edit_multiple_asset_losses_path, :method => :put, :id => "form1" do 
    %table.table-striped.table-hover.ogma
      %thead
        %tr
          %th{width: '5%'} &nbsp;
          %th{width: '17%'}=t 'asset.loss.loss_type'
          %th{width: '18%'}= sort_link(@search, :est_value, (t 'asset.loss.est_value'))
          %th{width: '20%'}= sort_link(@search, :asset_name, (t 'asset.loss.asset_name'))
          %th{width: '20%'}= sort_link(@search, :location_name, (t 'asset.loss.loss_location')) 
          %th{width: '20%'}= sort_link(@search, :lost_at, (t 'asset.loss.loss_date_time'))
      %tbody
        = render "index_search"
        - count=0
        - @asset_losses.group_by{|x|x.document}.each do |approval_document, asset_losses|
          %tr
            %td.group{colspan: 6}
              - unless approval_document.blank?
                =approval_document.doc_details+" : "
                =link_to (fa_icon "file-pdf-o")+" KEW-PA 31", kewpa31_asset_losses_path(format: "pdf", id: approval_document)
              - else
                =t('not_applicable')
         
          - for asset_loss in asset_losses
            %tr
              %td{:style=>"text-align: center;"}= check_box_tag "asset_loss_ids[]", asset_loss.id, true, :id => "assetlossidss_#{count}"
              %td= asset_loss.loss_type.capitalize
              %td= ringgols(asset_loss.est_value)
              %td= link_to asset_loss.asset.code_asset, asset_loss_path(asset_loss) 
              %td= asset_loss.try(:location).try(:name)	  
              %td= asset_loss.lost_at.strftime('%d %b %Y - %H:%M') unless asset_loss.lost_at.nil?
            - count+=1
        
    .row
      %br
      %span{:style=>"position: absolute; left: 40px;"}
        = check_box_tag :check_all
        = t('actions.check_all')
      %br
        
    .row 
      %br
      - if @asset_losses.count > 0
        .col-md-3.col-md-offset-1= submit_tag (t 'asset.loss.writeoff_checked'), :name => :loss_submit_button, class: "btn btn-default"


:javascript
$(document).ready(function(){
  var default_check = document.getElementById('check_all');
  default_check.checked = true;
  
  $("input[id='check_all']").change(function() {  
    var checkbox = document.getElementsByName('asset_loss_ids[]')
    if($('#check_all').is(':checked')) { 
      for (var j=0; j<checkbox.length; j++) {
        var cc = document.getElementById('assetlossidss_'+j)
        cc.checked = true;
      }
    }else{
      for (var j=0; j<checkbox.length; j++) {
        var cc = document.getElementById('assetlossidss_'+j)
        cc.checked = false;
      }
    }
  });

  $("input[id='check_all']").each(function() {  
    var checkbox = document.getElementsByName('asset_loss_ids[]')
    if($('#check_all').is(':checked')) { 
      for (var j=0; j<checkbox.length; j++) {
        var cc = document.getElementById('assetlossidss_'+j)
        cc.checked = true;
      }
    }else{
      for (var j=0; j<checkbox.length; j++) {
        var cc = document.getElementById('assetlossidss_'+j)
        cc.checked = false;
      }
    }
  });

};  

