.col-md-10
  %br
  /%span{style: 'padding-left: 250px;'}
  /  mmmmm
  
  - paper=@examanalysis.exampaper
  - @examquestions_by_type = paper.examquestions.group_by{|x|x.questiontype}.sort
  - if paper.sequ!= nil 
    - sequ = paper.sequ.split(",")
    - seq_questionid = [] 
    - hash_seqid = Hash.new
    - tosort_seqid = Hash.new
    - select_questionid = [] 
    - count = 0
    - listed_questions=[]
    
    /reference - /exams/_tab_question_details.html.haml
    /START-ASSIGN QUESTIONS WITH SEQUENCE INTO HASH & QUESTIONS WITHOUT SEQUENCE INTO ARRAY ACCORDINGLY
    - @examquestions_by_type.each do |qtype,examquestions|
      - for examquestion in examquestions 
        - if sequ[count] != "Select"
          - hash_seqid = {sequ[count] => examquestion.id}
          /FORMAT:grades = { "Jane Doe" => 10, "Jim Doe" => 6 }
          - tosort_seqid = tosort_seqid.merge(hash_seqid)
        - else 
          - select_questionid << examquestion.id
        - count+=1 
    /for question with sequence-SORT by its' sequence
    - tosort_seqid.sort_by{|k,v|k.to_i}.each do |x,y|
      - seq_questionid << y
    /for question with sequence-SORT by its' sequence
    /END-ASSIGN QUESTIONS WITH SEQUENCE INTO HASH & QUESTIONS WITHOUT SEQUENCE INTO ARRAY ACCORDINGLY
            
    /START-QUESTIONS WITH & WITHOUT SEQUENCE NO ACCORDINGLY
    /START-WORKABLE ONE-FOR EXAMQUESTION-WITH SEQUENCE NO
    - current_qtype = Examquestion.find(seq_questionid[0]).questiontype
    - 0.upto(tosort_seqid.count-1) do |count|
      - current_question = Examquestion.find(seq_questionid[count])
      - listed_questions << current_question
    /END-WORKABLE ONE-FOR EXAMQUESTION-WITH SEQUENCE NO	
    /START-WORKABLE ONE-FOR EXAMQUESTION-WITHOUT SEQUENCE NO
    - 0.upto(sequ.count-tosort_seqid.count-1) do |counter|
      - current_question = Examquestion.find(select_questionid[counter])       
      - listed_questions << current_question     
  - else
    /else for if @exam.sequ!= nil (SEQUENCE NEVER SET YET..first time data entry only:column sequence in exam table BLANK)
    - @examquestions_by_type.each do |qtype,examquestions|
      - examquestions.each_with_index do |examquestion, index|
        - current_question=examquestion
        - listed_questions << current_question
  
  - bil=0
  - exammarks=paper.exammarks
  - students=Student.where(id: exammarks.pluck(:student_id))
  - mcq_count= paper.examquestions.where(questiontype: 'MCQ').count
  - mcq_fullmarks=paper.examquestions.where(questiontype: 'MCQ').sum(:marks)
  %table.table-striped.table-hover.ogma
    %thead
      %tr
        %th.centre{colspan: 3}NO SOALAN
        - listed_questions.each_with_index do |question, nos|
          %th.centre=nos+1
        %th.centre JUMLAH MARKAH
      %tr
        %th.centre{colspan: 3}MARKAH PENUH
        - listed_questions.each_with_index do |question, nos|
          /- if nos==0
          /  %td{colspan: mcq_count, width: "#{mcq_count*5}%", align: 'center'}=mcq_fullmarks if mcq_count >= 1
          /- else
          /  - if question.questiontype!='MCQ'
          %th.centre=question.marks
        %th.centre=paper.total_marks
      %tr
        %th.centre{width: '3%'} SIRI
        %th.centre{width: '10%', style: 'align: center;'} NO. KP
        %th.centre{width: '15%'} NAMA
        - listed_questions.each_with_index do |question, nos|
          %th{width: '5%', style: 'background-color: grey;'}
        %th{width: '5%', style: 'background-color: grey;'}
    
    %tbody
      - for student in students.sort_by{|x|[x.id, x.name]}    
        %tr
          %td.centre=bil+=1
          %td=student.icno
          %td=student.name
          - acc_marks=0
          - total_mcq=exammarks.where(student_id: student.id).first.total_mcq
          - listed_questions.each_with_index do |question, nos|
            - if nos > mcq_count-1
              - indv_marks=exammarks.where(student_id: student.id).first.marks[nos-(mcq_count)].student_mark
              - acc_marks+=indv_marks
            /=question.id
            /=student.id
            - if nos==0
              %td{colspan: mcq_count, width: "#{mcq_count*5}%", align: 'center'}=total_mcq if mcq_count >= 1
            - else
              - if question.questiontype!='MCQ'
                %td.centre=indv_marks
          %td.centre=total_mcq+acc_marks

       