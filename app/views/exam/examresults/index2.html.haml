- model_class = Examresult
.page-header
  %h1= t('exam.examresult.exam_slip_transcript')
.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav
    /%li= link_to content_tag(:li, fa_icon("asterisk", text: (t 'actions.new'))), new_exam_examresult_path
  %ul.nav.navbar-nav.navbar-right
    %li.toga= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class: "index_search_bar"
    /%li.toga= link_to content_tag(:li, fa_icon("print", text: (t 'actions.print'))), "#", class: 'bogus'  

= render 'shared/flashes'
.row
  %table.table-striped.table-hover.ogma
    %thead
      %tr
        %th= sort_link(@search2, :student_id, (t 'exam.examresult.student'))
        %th= sort_link(@search2, :total, 'NGK')
        %th= sort_link(@search2, :pngs17, (t 'exam.examresult.pngs17'))
        %th PNGK
        %th= sort_link(@search2, :status, 'Status')

    %tbody
      = render "search_bar2"
      - @resultlines.group_by{|x|x.examresult.programmestudent.programme_list}.sort.each do |programme, resultlines|
        %tr
          %td.group{colspan: 5}=(t 'examresult.programme_id')+" : "+programme
        - resultlines.group_by{|x|x.examresult.intake_group}.each do |intake, resultlines2|
          %tr
            %td.group{colspan: 5}
              %span
              =(t 'exam.examresult.intake')+" :"
              =Date.new(intake[0,4].to_i, intake[5,2].to_i, intake[8,2].to_i).try(:strftime, '%b %Y').upcase
          - resultlines2.group_by{|x|x.student}.sort.each do |student, resultlines3|
            %tr
              %td.group{colspan: 5}
                =(t 'exam.examresult.student')+" : "+student.matrix_name
                - if Programme.where(course_type: 'Diploma').pluck(:id).include?(resultlines3.first.examresult.programme_id) 
                  = link_to (t 'exam.examresult.transcript'), show3_exam_examresults_path(student_id: student.id) if resultlines3.count == 6
                - else
                  = link_to (t 'exam.examresult.transcript'), show3_exam_examresults_path(student_id: student.id) if resultlines3.count == 2
            - for resultline in resultlines3.sort_by{|x|x.examresult_id}
              %tr
                %td= link_to resultline.examresult.render_semester, show2_exam_examresults_path(id: resultline.id)
                %td=h resultline.total.nil? ? "" : sprintf('%.2f', resultline.total) 
                %td=h resultline.pngs17.nil? ? "" : sprintf('%.2f', resultline.pngs17) 
                %td=h resultline.pngk.nil? ? "" : sprintf('%.2f', resultline.pngk) 
                %td=h resultline.render_status
        
  .right{style:"padding:0 30px; margin:0;"}= paginate @resultlines, :theme => 'twitter-bootstrap-3'
