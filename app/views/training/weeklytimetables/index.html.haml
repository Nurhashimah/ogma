- model_class = Weeklytimetable
.page-header
  %h1= t('training.weeklytimetable.title')
  
.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav
    - permitted_to? :create, :training_weeklytimetables do
      /HACK - restrict access from non-coordinator
      - if @is_coordinator || @is_admin
        %li= link_to content_tag(:li, fa_icon("asterisk", text: (t 'actions.new'))), new_training_weeklytimetable_path
  %ul.nav.navbar-nav.navbar-right
    %li.toga= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class: "index_search_bar"
    %li= link_to  (fa_icon "file-pdf-o", text: (t 'print')),  weeklytimetable_report_training_weeklytimetables_path(params.merge(format: 'pdf' ))

.row.filter{style: "display:none;"}
  .col-md-2
   
.row
  %table.table-striped.table-hover.ogma
    %thead
      %tr
        %th{width: '25%'}= sort_link(@search, :programme_id, (t 'training.weeklytimetable.programme_id'))
        - if current_user.college.code=='amsas'
          %th{width: '7%'}= sort_link(@search, :intake_id, (t 'training.weeklytimetable.intake_id'))
          %th{width: '15%'}= sort_link(@search, :format1, "Format")
        - else
          %th{width: '12%'}= sort_link(@search, :intake_id, (t 'training.weeklytimetable.intake_id'))
        %th{width: '8%'}= sort_link(@search, :startdate, (t 'training.weeklytimetable.startdate'))
        %th{width: '8%'}= sort_link(@search, :end_date, (t 'training.weeklytimetable.enddate'))
        - if current_user.college.code!='amsas'
          %th{width: '7%'}= sort_link(@search, :semester, (t 'training.weeklytimetable.semester'))
          %th{width: '17%'}= sort_link(@search, :prepared_by, (t 'training.weeklytimetable.prepared_by'))
        - else
          %th{width: '27%'}= sort_link(@search, :prepared_by, (t 'training.weeklytimetable.prepared_by'))
        %th{width: '10%'}= sort_link(@search, :is_submitted, (t 'training.weeklytimetable.is_submitted'))
        %th{width: '10%'}= sort_link(@search, :hod_approved, (t 'training.weeklytimetable.is_approved'))

    %tbody
    = render "index_search"
    - @weeklytimetables.group_by{|x|x.programme_id}.each do |p,weeklytimetables|
      - weeklytimetables.each do |weeklytimetable|
        %tr
          %td=h link_to weeklytimetable.try(:schedule_programme).try(:programme_list), training_weeklytimetable_path(weeklytimetable)     
          %td=h weeklytimetable.college.code=="amsas"? weeklytimetable.schedule_intake.siri_name : weeklytimetable.schedule_intake.group_with_intake_name
          - if current_user.college.code=='amsas'
            - if current_user.college.name.include?('amsas')
              %td=h weeklytimetable.timetable_monthurs.name.include?('BK-LAT') ? weeklytimetable.timetable_monthurs.name[0,16] : weeklytimetable.timetable_monthurs.name
            - else
              - if weeklytimetable.timetable_monthurs.name.include?("BK-LAT-URK-01-01")
                %td
                  =h weeklytimetable.timetable_monthurs.name.gsub("BK-LAT-URK-01-01", "")
                  - if weeklytimetable.format1!=weeklytimetable.format2
                    =" / "+weeklytimetable.timetable_friday.name.gsub("BK-LAT-URK-01-01", "")
              - elsif weeklytimetable.timetable_monthurs.name.include?("BK-LAT-RAN-01-01")
                %td
                  =h weeklytimetable.timetable_monthurs.name.gsub("BK-LAT-RAN-01-01", "")
                  - if weeklytimetable.format1!=weeklytimetable.format2
                    =" / "+weeklytimetable.timetable_friday.name.gsub("BK-LAT-RAN-01-01", "")
              - else
                - if weeklytimetable.format1==weeklytimetable.format2
                  %td=h weeklytimetable.timetable_monthurs.name
                - else
                  %td=h weeklytimetable.timetable_monthurs.name+" / "+weeklytimetable.timetable_friday.name

          %td=h weeklytimetable.college.code=='amsas' ? weeklytimetable.try(:startdate).try(:strftime, "%d-%m-%Y") : weeklytimetable.try(:startdate).try(:strftime, "%d %b %Y") 
          %td=h weeklytimetable.college.code=='amsas' ? weeklytimetable.try(:enddate).try(:strftime, "%d-%m-%Y") : weeklytimetable.try(:enddate).try(:strftime, "%d %b %Y") 
          - if current_user.college.code!='amsas'
            %td=h weeklytimetable.try(:academic_semester).try(:semester)
          %td=h weeklytimetable.schedule_creator.staff_with_rank
          %td
            =h weeklytimetable.is_submitted? ? fa_icon('check') : fa_icon('times')
            - if weeklytimetable.hod_rejected==true && weeklytimetable.is_submitted==nil 
              = t 'training.weeklytimetable.is_returned'
            - elsif weeklytimetable.hod_rejected_on!=nil && weeklytimetable.is_submitted==true && weeklytimetable.hod_approved!=true
              = t 'training.weeklytimetable.is_resubmitted'
          %td
            =h weeklytimetable.hod_approved? ? fa_icon('check') : fa_icon('times')
            =h weeklytimetable.hod_rejected? ? "- "+(t 'rejected') : "" 

  .right{style:"padding:0 30px; margin:0;"}= paginate @weeklytimetables, :theme => 'twitter-bootstrap-3'


%BR
%BR
%BR
%BR
/ if (weeklytimetable.is_submitted != true && weeklytimetable.prepared_by == current_user.staff_id) || (weeklytimetable.prepared_by == current_user.staff_id && weeklytimetable.hod_rejected? == true && weeklytimetable.is_submitted==nil) 
/= link_to image_tag("edit.png", :border => 0, :title => 'Edit'), :action => 'edit', :id => weeklytimetable
/elsif (weeklytimetable.is_submitted == true && weeklytimetable.endorsed_by == current_user.staff_id && weeklytimetable.hod_approved!= true)  %>
/link_to image_tag("approval.png", :border => 0), :action => 'edit', :id => weeklytimetable 


/= link_to image_tag("printer.png", :border => 0, :title => 'General Timetable'), :action => 'general_timetable', :id => weeklytimetable 



