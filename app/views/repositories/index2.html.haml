- model_class = Repository
.page-header
  %h1= t('repositories.list2')
  
.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav
    - permitted_to? :create, :repositories do
      %li= link_to content_tag(:li, fa_icon("asterisk", text: (t 'actions.new'))), new2_repositories_path
    - permitted_to? :manage, :library_librarytransactions do
      %li= link_to content_tag(:li, fa_icon("th-list", text: (t 'library.transaction.title'))), repository_loan_library_librarytransactions_path
  %ul.nav.navbar-nav.navbar-right
    /%li= link_to (t 'equery.title'), "/equery_reports?query_module=8"
    %li= link_to content_tag(:li, fa_icon("search-plus", text: (t 'equery.title2'))), new_equery_report_repositorysearch_path(searchrepotype: '2')
    %li= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class: "index_search_bar"
    %li= link_to  (fa_icon "file-pdf-o", text: (t 'print')), repository_list2_repositories_path(params.merge(format: 'pdf' ))

.row
  .col-md-12
    .alert.alert-warning.small
      %strong=t 'repositories.legend'
      %table
        %tr
          %td{colspan: 2}="<u>#{(t 'column')} : #{(t 'repositories.loan')}</u>".html_safe
          %td
          %td{colspan: 2}="<u>#{(t 'column')} : #{(t 'repositories.e_document')}</u>".html_safe
          %td
        %tr
          %td.centre{width: '5%', style: 'color: black;'}=fa_icon("plus-circle")
          %td{width: '20%'}=(t 'repositories.loan_allowed')
          %td{width: '5%'}
          %td.centre{width: '5%', style: 'color: black;'}=fa_icon("file-pdf-o")
          %td{width: '20%'}=(t 'repositories.available')
          %td{width: '45%'}
        %tr
          %td.centre.text-red=fa_icon("exclamation-circle")
          %td=(t 'repositories.loan_prohibited')
          %td
          %td.centre.text-red=fa_icon("chain-broken")
          %td=(t 'repositories.not_available')
          %td
            
  %table.table-striped.table-hover.ogma
    %thead
      %tr
        %th{width: '5%'} No
        %th{width: '18%'}=sort_link(@search, :vessel, (t 'repositories.vessel'))
        %th{width: '30%'}= sort_link(@search, :title, (t 'repositories.document_title'))
        %th{width: '22%'}= sort_link(@search, :refno, (t 'repositories.refno2'))
        %th{width: '9%'}= sort_link(@search, :publish_date, (t 'repositories.publish_date'))
        /%th{width: '15%'}= sort_link(@search, :location, (t 'repositories.location'))
        /%th{width: '10%'}= (t 'repositories.copies')+" / "+(t 'repositories.total_pages')
        %th{width: '10%', colspan: 2}=(t 'repositories.classification')+" | "+(t 'repositories.loan')
        %th{width: '6%'}=(t 'repositories.e_document')
        
    %tbody
      = render "repositories/digital_library/index_search"
      - cnt=0
      - @repositories.group_by{|x|x.document_type}.sort.each do |document_type, repos|
        %tr
          %td.group{colspan: 9}=repos[0].render_document.upcase
        - repos.group_by{|y|y.document_subtype}.each do |document_subtype, repositories|
          %tr
            %td.group{colspan: 9}=repositories[0].render_subdocument
          - for repository in repositories.sort_by(&:vessel)
            %tr
              %td=cnt+=1
              %td=repository.vessel
              %td= link_to repository.title, repository_path(repository)
              %td=repository.refno
              %td.centre=repository.publish_date
              /%td=repository.location
              /%td.centre=repository.copies.to_s+" / "+repository.total_pages.to_s
              %td.centre=repository.render_classification
              %td.centre
                - if repository.classification=="3"
                  .text-red= fa_icon("exclamation-circle")
                - else
                  - loaned=Librarytransaction.marine_loaned_serial
                  - if loaned.include?(repository.code)
                    =t 'repositories.on_loan'
                  - else
                    =link_to (fa_icon "plus-circle"), loan_repository_path(repository)
              %td.centre
                - unless repository.uploaded.blank?
                  =link_to (fa_icon "file-pdf-o"), repository.uploaded.url 
                - else
                  .text-red= fa_icon("chain-broken")
                

  .right{style:"padding:0 30px; margin:0;"}= paginate @repositories, :theme => 'twitter-bootstrap-3'