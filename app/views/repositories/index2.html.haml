- model_class = Repository
.page-header
  %h1= t('repositories.list2')
  
.navbar.navbar-inverse{role: "navigation", style: "padding-right:40px;"}
  %ul.nav.navbar-nav
    /- permitted_to? :create, :repositories do
    %li= link_to content_tag(:li, fa_icon("asterisk", text: (t 'actions.new'))), new2_repositories_path
  %ul.nav.navbar-nav.navbar-right
    /%li= link_to (t 'equery.title'), "/equery_reports?query_module=8"
    %li= link_to content_tag(:li, fa_icon("search-plus", text: (t 'equery.title2'))), new_equery_report_repositorysearch_path(searchrepotype: '2')
    %li= link_to content_tag(:li, fa_icon("search", text: (t 'actions.search'))), "#", class: "index_search_bar"
    %li= link_to  (fa_icon "file-pdf-o", text: (t 'print')), repository_list2_repositories_path(params.merge(format: 'pdf' ))

.row
  .col-md-12
  %table.table-striped.table-hover.ogma
    %thead
      %tr
        %th{width: '5%'} No
        %th{width: '13%'}=sort_link(@search, :vessel, (t 'repositories.vessel'))
        %th{width: '25%'}= sort_link(@search, :title, (t 'repositories.document_title'))
        %th{width: '17%'}= sort_link(@search, :refno, (t 'repositories.refno2'))
        %th{width: '9%'}= sort_link(@search, :publish_date, (t 'repositories.publish_date'))
        %th{width: '15%'}= sort_link(@search, :location, (t 'repositories.location'))
        /%th{width: '10%'}= (t 'repositories.copies')+" / "+(t 'repositories.total_pages')
        %th{width: '10%'}=(t 'repositories.classification')
        %th{width: '6%'} &nbsp;
        
    %tbody
      = render "repositories/digital_library/index_search"
      - cnt=0
      - @repositories.group_by{|x|x.document_type}.sort.each do |document_type, repos|
        %tr
          %td.group{colspan: 8}=repos[0].render_document.upcase
        - repos.group_by{|y|y.document_subtype}.each do |document_subtype, repositories|
          %tr
            %td.group{colspan: 8}=repositories[0].render_subdocument
          - for repository in repositories.sort_by(&:vessel)
            %tr
              %td=cnt+=1
              %td=repository.vessel
              %td= link_to repository.title, repository_path(repository)
              %td=repository.refno
              %td.centre=repository.publish_date
              %td=repository.location
              /%td.centre=repository.copies.to_s+" / "+repository.total_pages.to_s
              %td.centre=repository.render_classification
              %td.centre
                - unless repository.uploaded.blank?
                  =link_to (fa_icon "file-pdf-o"), repository.uploaded.url 
                - else
                  = fa_icon("chain-broken")

  .right{style:"padding:0 30px; margin:0;"}= paginate @repositories, :theme => 'twitter-bootstrap-3'