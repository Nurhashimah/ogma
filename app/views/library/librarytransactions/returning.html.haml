- model_class = Library
.page-header
  %h1= t 'library.transaction.returning'

= render 'shared/flashes'

.row
  = form_for [:library, @librarytransaction], html: { multipart: true, class: 'form-horizontal' }  do |f| 
    = render 'shared/error_messages', object: f.object
    = hidden_field_tag :redirect_location, library_librarytransactions_path 
    = f.hidden_field :libreturned_by, :value => @current_user.userable_id
    .row
      .col-md-8.col-md-offset-3
        %dl.dl-horizontal
          %dt= t 'library.book.title'
          %dd=@librarytransaction.accession.try(:acc_book)

          %dt=t 'library.transaction.borrower'
          %dd=@librarytransaction.ru_staff==true ? @librarytransaction.staff.name : @librarytransaction.student.name
          
          %dt=t 'library.transaction.checkoutdate'
          %dd=@librarytransaction.checkoutdate.try(:strftime, '%d %b %Y')+" ("+@librarytransaction.libcheckoutby.try(:name)+")"
          
          %dt=t 'library.transaction.returnduedate'
          %dd=@librarytransaction.returnduedate.try(:strftime, '%d %b %Y')
          =f.hidden_field :returnduedate
      .col-md-12.col-md-offset-3
        .form-group
          .col-sm-2.control-label
            = f.label (t 'library.transaction.return')
          .col-md-1
            = f.check_box :returned, :id => 'is_returned'
        .form-group.span_returned_on
          .col-sm-2.control-label
            = f.label (t 'library.transaction.returneddate')
          .col-md-2
            = f.text_field :returneddate, class: 'date_picker_reverse form-control', value: "#{Date.today.strftime('%d-%m-%Y')}"

        /exceed due date
        .span_fine
          .form-group
            .col-sm-2.control-label
              = f.label (t 'library.transaction.fine')
            .col-md-2
              = f.text_field :fine, class: 'form-control',  :value => @librarytransaction.recommended_fine_value
              - if @librarytransaction.returnduedate < Date.today 
                late by 
                =(Date.today-@librarytransaction.returnduedate).to_i
                days x RM 1.00/day
              
              
          /#TODO  to implement fine = returned date - duedate * RM1/day 
          .form-group
            .col-sm-2.control-label
              = f.label (t 'library.transaction.finepay')
            .col-md-1
              = f.check_box :finepay
          .form-group
            .col-sm-2.control-label
              = f.label (t 'library.transaction.finepaydate')
            .col-md-2
              = f.text_field :finepaydate, class: 'date_picker_reverse form-control'
          
    .row
      .form-group
        .col-md-1.col-md-offset-5
          = link_to content_tag(:i, "", :class => "fa fa-arrow-left ") + " " + t('.back', :default => t("helpers.links.back")), library_librarytransactions_path, :class => 'btn btn-default'
        .col-md-2
          .div{style: "margin-left:-40px;"}
            = f.submit t('update'), class: "btn btn-primary"

:javascript

$(document).ready(function(){
  $("input[id='is_returned']").change(function() {  
    if($('#is_returned').is(':checked')) { 
      $('.span_returned_on').show("highlight");
      $('.span_fine').show("highlight");
       /*var returndate=document.getElementById("librarytransaction_returneddate").value;*/
       /*var fine=document.getElementById("librarytransaction_fine").value;*/
       /*alert(fine);*/
    }
    else
    { 
      $('.span_returned_on').hide();
      $('.span_fine').hide();
    }
  });
  $("input[id='is_returned']").each(function() {  
    if($('#is_returned').is(':checked')) { 
      $('.span_returned_on').show("highlight");
      $('.span_fine').show("highlight");
    }
    else
    {
      $('.span_returned_on').hide();
      $('.span_fine').hide();;
    }
  });
 
}); 