- model_class = Librarytransaction
.page-header
  %h1= t('library.transaction.manager')

- unless @selected_staff || @selected_student
  .row
    .col-md-3
      .btn-group.right{"data-toggle" => "buttons"}
        %button.btn.btn-default.btn-lgbtn#option_student{style: "width:90px;"}
          %input#option1{:name => "options", :type => "radio"}
            = (t 'people.student')
        %button.btn.btn-default.btn-lgbtn#option_staff{style: "width:90px;"}
          %input#option2{:name => "options", :type => "radio"}
            = (t 'people.staff')
    .col-md-6.staff_search{style: "display:none;"}
      = form_for :search, :url => { :action => "manager" }, :html=>{:class => "form-horizontal", :role => "form", :style => 'padding: 0 30px 0 30px; margin-top: 0;' } do |f|
        .input-group
          = f.text_field :staff_name, data: {autocomplete_source: Staff.order(:name).map(&:name)}, :autofocus => true, :required => true, :class => 'form-control search-field', :type => "input", placeholder: (t 'staff.name')
          %span.input-group-btn
            = f.submit (t 'search'), :class => "btn btn-primary", style: "width:80px;"
        %span.help-block.small= (t 'library.check.search')
      
    .col-md-6.student_search{style: "display:none;"}
      = form_for :search, :url => { :action => "manager" }, :html=>{:class => "form-horizontal", :role => "form", :style => 'padding: 0 30px 0 30px; margin-top: 0;' } do |f|
        .input-group
          = f.text_field :student_icno, data: {autocomplete_source: Student.order(:icno).map(&:icno)}, :autofocus => true, :required => true, :class => 'form-control search-field', :type => "input", placeholder: "IC Starts with"#, value: (@params_student_ic = params[:search].try(:[], :student_icno))
          %span.input-group-btn
            = f.submit (t 'search'), :class => "btn btn-primary", style: "width:80px;"
        %span.help-block.small= (t 'library.check.search')

- if @selected_staff || @selected_student
  .row
    .col-md-10.col-sm-offset-1
      - if @existing_library_transactions.count < @booklimit; @panel = "panel-info"; else @panel = "panel-danger"; end
      .panel{:class => @panel}
        - if @selected_staff
          .panel-heading
            = t( 'activerecord.models.staff')
            &nbsp; : &nbsp;
            = @selected_staff.name
            %span.badge.right= @existing_library_transactions.count
          .panel-body
            %dl.dl-horizontal

              %dt= t 'staff.name'
              %dd= @selected_staff.name

              %dt= t 'staff.icno'
              %dd= @selected_staff.icno
            
              %dt= t 'position.name'
              %dd= @selected_staff.try(:position).try(:name)
            %hr
            = render 'book_list'          
        - if @selected_student
          .panel-heading Student
          .panel-body
            %dl.dl-horizontal

              %dt= t 'student.name'
              %dd= @selected_student.name

              %dt= t 'student.matrixno'
              %dd= @selected_student.matrixno
            
              %dt= t 'student.icno'
              %dd= @selected_student.icno
            
              %dt= t 'student.programme'
              %dd= @selected_student.try(:course).try(:name)


  - if @existing_library_transactions.count < @booklimit
    .row
      .col-md-10.col-sm-offset-1
        .button-toolbar.pull-right
          = link_to content_tag(:i, "", class: "fa fa-bookmark"),
            new_library_librarytransaction_path, {id: "new_link", remote: true, class: "btn btn-default", :type => "button", "data-toggle" => "tooltip", title: "Add Book"}
          = link_to content_tag(:i, "", class: "fa fa-repeat"),
             manager_library_librarytransactions_path, {class: "btn btn-default", :type => "button", "data-toggle" => "tooltip", title: "Reset Form"}
        #add_book_form(style="display:none;")
          = render :partial => 'form'
        //.right= link_to "Add Book", new_library_librarytransaction_path, id: "new_link", remote: true

/        
/          .btn-group
/            = link_to content_tag(:i, "", class: "glyphicon glyphicon-edit icon-white"),
/              edit_aggregators_merchant_path(:id=>merchant.id), {class: "btn btn-default", :type => "button", "data-toggle" => "tooltip", title: "Edit"} if can? :manage_agreements, partner
/            = link_to content_tag(:i, "", class: 'glyphicon glyphicon-transfer'), '#', :request_url => request_access_aggregators_merchant_path(merchant), 'data-toggle' => "modal", 'data-target'=> "#access-modal", class: "btn btn-default", :type => "button", :title => 'Request access'
/            = link_to content_tag(:i, "", class: 'glyphicon glyphicon-bullhorn'), new_campaign_path(:partner_id => merchant), class: "btn btn-default", :type => "button", "data-toggle" => "tooltip", title: "New Campaign"
/            - if agreement = agreement_of_interest(merchant)
/              = link_to content_tag(:i, "", class: 'glyphicon glyphicon-list-alt'), partner_agreements_path(merchant_id: merchant.id), class: "btn btn-default", :type => "button", "data-toggle" => "tooltip", title: 'View Agreements' #show_aggregator_merchant_agreement_path(agreement)

    